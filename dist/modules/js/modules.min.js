!function(e){"use strict";e.registerWidget({widgetType:"dropDown",widgetClass:"drop-down",templates:{trigger:function(e){var n,t=[],d=e||{};return function(e,d){var i=["drop-down__trigger"];e&&i.push("drop-down__trigger--fixed"),t.push("\n<button"+jade.cls([i],[!0])+">"+jade.escape(null==(n=d)?"":n)+"</button>")}.call(this,"fixedTrigger"in d?d.fixedTrigger:"undefined"!=typeof fixedTrigger?fixedTrigger:void 0,"triggerText"in d?d.triggerText:"undefined"!=typeof triggerText?triggerText:void 0),t.join("")},menu:function(e){var n,t=[],d=e||{};return function(e,d,i){var o=["drop-down__menu","drop-down__menu--hidden"];d&&o.push("drop-down__menu--flush-right"),t.push("\n<ul"+jade.cls([o],[!0])+">"),function(){var d=i;if("number"==typeof d.length)for(var o=0,r=d.length;r>o;o++){var s=d[o],a=["drop-down__menu-option"];s.isCurrent&&a.push("drop-down__menu-option--current"),s.isCurrent&&e&&a.push("drop-down__menu-option--hidden"),t.push("\n  <li"+jade.cls([a],[!0])+'><a tabindex="-1" href="javascript:;" class="drop-down__menu-option-trigger">'+jade.escape(null==(n=s.text)?"":n)+"</a></li>")}else{var r=0;for(var o in d){r++;var s=d[o],a=["drop-down__menu-option"];s.isCurrent&&a.push("drop-down__menu-option--current"),s.isCurrent&&e&&a.push("drop-down__menu-option--hidden"),t.push("\n  <li"+jade.cls([a],[!0])+'><a tabindex="-1" href="javascript:;" class="drop-down__menu-option-trigger">'+jade.escape(null==(n=s.text)?"":n)+"</a></li>")}}}.call(this),t.push("\n</ul>")}.call(this,"currentIsHidden"in d?d.currentIsHidden:"undefined"!=typeof currentIsHidden?currentIsHidden:void 0,"flushRight"in d?d.flushRight:"undefined"!=typeof flushRight?flushRight:void 0,"menuItems"in d?d.menuItems:"undefined"!=typeof menuItems?menuItems:void 0,"undefined"in d?d.undefined:void 0),t.join("")}},build:function(n,t){var d,i,o,r,s,a,l,c,u=n.querySelectorAll(".drop-down__select")[0],p=n.querySelectorAll(".drop-down__menu")[0],w=0,g={menuItems:[]},m={},h="",f=e.registeredWidgets[t];if(u){for(s=/(^| )drop-down__select--hide-current( |$)/g.test(u.className),a=/(^| )drop-down__select--flush-right( |$)/g.test(u.className),g.currentIsHidden=s,g.flushRight=a,u.className+=" drop-down__select--hidden",o=u.children,w=0,d=o.length;d>w;w+=1)i=o[w],g.menuItems.push({text:i.innerHTML,isCurrent:i.selected}),i.selected&&(r=i.innerHTML);m.triggerText=r,h+=f.templates.trigger(m),h+=f.templates.menu(g)}else if(p){for(o=p.children,w=0,d=o.length;d>w;w+=1)o[w].children[0].tabIndex=-1;p.className+=" drop-down__menu--hidden",m.triggerText="Menu",h+=f.templates.trigger(m)}if(l=document.createElement("div"),l.innerHTML=h,c=l.children,u)for(;c.length;)n.appendChild(c[0]);else if(p)for(;c.length;)n.insertBefore(c[0],p)},enhance:function(e){var n=e.querySelectorAll(".drop-down__trigger")[0],t=e.querySelectorAll(".drop-down__menu")[0],d=/(^| )drop-down__menu--hidden( |$)/g,i=/(^| )drop-down__menu--hidden( |$)/,o=/(^| )drop-down__trigger--active( |$)/g,r=/(^| )drop-down__menu--fixed( |$)/,s=e.clientWidth,a=t.clientWidth,l=function(n){var t;n.detail.widget!==e&&(t=new window.CustomEvent("dropDownHide"),e.dispatchEvent(t))};a>s&&r.test(t.className)&&(e.style.width=a+"px"),n.addEventListener("click",function(n){var d,o;return n.preventDefault(),i.test(t.className)?(d=new window.CustomEvent("dropDownShow"),e.dispatchEvent(d)):(o=new window.CustomEvent("dropDownHide"),e.dispatchEvent(o)),!1},!0),e.addEventListener("keyup",function(d){var o,r,s,a;if(a=/(^| )drop-down__menu-option--hidden( |$)/,i.test(t.className))32===d.keyCode&&"A"===d.target.tagName&&d.target.click(),(39===d.keyCode||40===d.keyCode)&&(o=new window.CustomEvent("dropDownShow"),e.dispatchEvent(o));else{if(32===d.keyCode&&"A"===d.target.tagName&&d.target.click(),37===d.keyCode||38===d.keyCode)if("BUTTON"===d.target.tagName)r=new window.CustomEvent("dropDownHide"),e.dispatchEvent(r);else{for(s=d.target.parentElement.previousSibling,s&&a.test(s.className)&&(s=s.previousSibling);s&&1!==s.nodeType;)s=s.previousSibling,s&&a.test(s.className)&&(s=s.previousSibling);s?s.children[0].focus():n.focus()}if(39===d.keyCode||40===d.keyCode){for(s="BUTTON"===d.target.tagName?t.children[0]:d.target.parentElement.nextSibling,s&&a.test(s.className)&&(s=s.nextSibling);s&&1!==s.nodeType;)s=s.nextSibling,s&&a.test(s.className)&&(s=s.nextSibling);s&&s.children[0].focus()}}},!0),t.addEventListener("click",function(n){var t;"A"===n.target.tagName&&(t=new window.CustomEvent("dropDownSelect",{detail:{select:n.target}}),e.dispatchEvent(t))},!0),e.addEventListener("dropDownShow",function(){var i,r,s,a;i=new window.CustomEvent("dropDownWillShow",{detail:{widget:e}}),e.dispatchEvent(i),document.body.dispatchEvent(i),s=t.className,a=n.className,s=s.replace(d," "),a=a.replace(o," ")+" drop-down__trigger--active",t.className=s,n.className=a,r=new window.CustomEvent("dropDownDidShow",{detail:{widget:e}}),document.body.addEventListener("dropDownWillShow",l,!0),t.scrollTop=1,t.scrollTop=0,n.focus(),e.dispatchEvent(r)},!0),e.addEventListener("dropDownHide",function(){var i,r,s,a;i=new window.CustomEvent("dropDownWillHide",{detail:{widget:e}}),e.dispatchEvent(i),s=t.className,a=n.className,s=s.replace(d," ")+" drop-down__menu--hidden",a=a.replace(o," "),t.className=s,n.className=a,r=new window.CustomEvent("dropDownDidHide",{detail:{widget:e}}),document.body.removeEventListener("dropDownWillShow",l,!0),e.dispatchEvent(r)},!0),e.addEventListener("dropDownSelect",function(d){var i,o,r,s,a,l,c,u,p=d.detail.select,w=/(^| )drop-down__menu-option(-container)?--current( |$)/g,g=/(^| )drop-down__menu-option--hidden( |$)/g,m=/(^| )drop-down__trigger--fixed( |$)/g,h=e.querySelectorAll(".drop-down__menu-option--hidden").length;if(!m.test(n.className))for(n.innerHTML=p.innerHTML,r=t.children,s=0,a=r.length;a>s;s+=1)l=r[s],c=l.className,u=l.children[0].className,c=c.replace(w," "),c=c.replace(g," "),u=u.replace(w," "),l.children[0]===p&&(c+=" drop-down__menu-option--current",u+=" drop-down__menu-option-trigger",h&&(c+=" drop-down__menu-option--hidden")),l.className=c,l.children[0].className=u;o=new window.CustomEvent("dropDownHide",{detail:{widget:e}}),n.focus(),i=new window.CustomEvent("dropDownDidSelect",{detail:{widget:d.detail.widget,selected:d.detail.select}}),e.dispatchEvent(i),e.dispatchEvent(o)},!0)}})}(window.SignalUI);